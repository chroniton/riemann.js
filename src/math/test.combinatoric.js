if (RiemannJS.test == undefined) {
  RiemannJS.test = Object.create(null);
}

RiemannJS.test.combinatoric = function(verbose) {
  console.log("[TEST] (combinatoric) start");
  var results = [
    this.test_factorial(verbose),
    this.test_binomial(verbose),
    ];
  var fsum = function(a,b) { return a+b; };
  var sum = results.reduce(fsum);
  if (sum > 0) {
    console.error("... total test failures:", sum);
  }
  console.log("[TEST] (combinatoric) end");
};

RiemannJS.test.combinatoric.prototype.test_factorial = function(verbose) {
  console.log("... test factorial(n)");
  var tv = [
    [  0, 1                  ],
    [  1, 1                  ],
    [  2, 2                  ],
    [  3, 6                  ],
    [  4, 24                 ],
    [  5, 120                ],
    [  6, 720                ],
    [  7, 5040               ],
    [  8, 40320              ],
    [  9, 362880             ],
    [ 10, 3628800            ],
    [ 11, 39916800           ],
    [ 12, 479001600          ],
    [ 13, 6227020800         ],
    [ 14, 87178291200        ],
    [ 15, 1307674368000      ],
    [ 16, 20922789888000     ],
    [ 17, 355687428096000    ],
    [ 18, 6402373705728000   ],
    [ 19, 121645100408832000 ],
    [ 20, 2432902008176640000             ],
    [ 21, 51090942171709440000            ],
    [ 22, 1124000727777607680000          ],
    [ 23, 25852016738884976640000         ],
    [ 24, 620448401733239439360000        ],
    [ 25, 15511210043330985984000000      ],
    [ 26, 403291461126605635584000000     ],
    [ 27, 10888869450418352160768000000   ],
    //[ 28, 304888344611713860501504000000  ],
    //[ 29, 8841761993739701954543616000000 ],
    ];

  var n = 0;
  var v = 1;
  var failures = 0;
  for (var x=0; x<tv.length; x++) {
    n = tv[x][0];
    v = tv[x][1];
    r = RiemannJS.factorial(n);
    if (v != r) {
      console.error("... factorial(" + n + ") -> " + r, "actual: " + v); 
      failures++;
    } else if (verbose) {
      console.log("... factorial(" + n + ") -> " + r); 
    }
  }

  if (failures > 0) {
    console.error("... factorial test failures:", failures);
  }
  return failures;
};


RiemannJS.test.combinatoric.prototype.test_binomial = function(verbose) {
  console.log("... test binomial(n,k)");

  var tv = [
    [[0, 0], 1.0],
    [[0, 1], 0.0],
    [[0, 2], 0.0],
    [[0, 3], 0.0],
    [[0, 4], 0.0],
    [[0, 5], 0.0],
    [[0, 6], 0.0],
    [[1, 0], 1.0],
    [[1, 1], 1.0],
    [[1, 2], 0.0],
    [[1, 3], 0.0],
    [[1, 4], 0.0],
    [[1, 5], 0.0],
    [[1, 6], 0.0],
    [[2, 0], 1.0],
    [[2, 1], 2.0],
    [[2, 2], 1.0],
    [[2, 3], 0.0],
    [[2, 4], 0.0],
    [[2, 5], 0.0],
    [[2, 6], 0.0],
    [[3, 0], 1.0],
    [[3, 1], 3.0],
    [[3, 2], 3.0],
    [[3, 3], 1.0],
    [[3, 4], 0.0],
    [[3, 5], 0.0],
    [[3, 6], 0.0],
    [[4, 0], 1.0],
    [[4, 1], 4.0],
    [[4, 2], 6.0],
    [[4, 3], 4.0],
    [[4, 4], 1.0],
    [[4, 5], 0.0],
    [[4, 6], 0.0],
    [[5, 0], 1.0],
    [[5, 1], 5.0],
    [[5, 2], 10.0],
    [[5, 3], 10.0],
    [[5, 4], 5.0],
    [[5, 5], 1.0],
    [[5, 6], 0.0],
    [[6, 0], 1.0],
    [[6, 1], 6.0],
    [[6, 2], 15.0],
    [[6, 3], 20.0],
    [[6, 4], 15.0],
    [[6, 5], 6.0],
    [[6, 6], 1.0],
    [[27, 0], 1.0],
    [[27, 1], 27.0],
    [[27, 2], 351.0],
    [[27, 3], 2925.0],
    [[27, 4], 17550.0],
    [[27, 5], 80730.0],
    [[27, 6], 296010.0],
    [[27, 7], 888030.0],
    [[27, 8], 2220075.0],
    [[27, 9], 4686825.0],
    [[27, 10], 8436285.0],
    [[27, 11], 13037895.0],
    [[27, 12], 17383860.0],
    [[27, 13], 20058300.0],
    [[27, 14], 20058300.0],
    [[27, 15], 17383860.0],
    [[27, 16], 13037895.0],
    [[27, 17], 8436285.0],
    [[27, 18], 4686825.0],
    [[27, 19], 2220075.0],
    [[27, 20], 888030.0],
    [[27, 21], 296010.0],
    [[27, 22], 80730.0],
    [[27, 23], 17550.0],
    [[27, 24], 2925.0],
    [[27, 25], 351.0],
    [[27, 26], 27.0],
    [[27, 27], 1.0],
    [[50, 0], 1.0],
    [[50, 1], 50.0],
    [[50, 2], 1225.0],
    [[50, 3], 19600.0],
    [[50, 4], 230300.0],
    [[50, 5], 2118760.0],
    [[50, 6], 15890700.0],
    [[50, 7], 99884400.0],
    [[50, 8], 536878650.0],
    [[50, 9], 2505433700.0],
    [[50, 10], 10272278170.0],
    [[50, 11], 37353738800.0],
    [[50, 12], 121399651100.0],
    [[50, 13], 354860518600.0],
    [[50, 14], 937845656300.0],
    [[50, 15], 2250829575120.0],
    [[50, 16], 4923689695575.0],
    [[50, 17], 9847379391150.0],
    [[50, 18], 18053528883775.0],
    [[50, 19], 30405943383200.0],
    [[50, 20], 47129212243960.0],
    [[50, 21], 67327446062800.0],
    [[50, 22], 88749815264600.0],
    [[50, 23], 108043253365600.0],
    [[50, 24], 121548660036300.0],
    [[50, 25], 126410606437752.0],
    [[50, 26], 121548660036300.0],
    [[50, 27], 108043253365600.0],
    [[50, 28], 88749815264600.0],
    [[50, 29], 67327446062800.0],
    [[50, 30], 47129212243960.0],
    [[50, 31], 30405943383200.0],
    [[50, 32], 18053528883775.0],
    [[50, 33], 9847379391150.0],
    [[50, 34], 4923689695575.0],
    [[50, 35], 2250829575120.0],
    [[50, 36], 937845656300.0],
    [[50, 37], 354860518600.0],
    [[50, 38], 121399651100.0],
    [[50, 39], 37353738800.0],
    [[50, 40], 10272278170.0],
    [[50, 41], 2505433700.0],
    [[50, 42], 536878650.0],
    [[50, 43], 99884400.0],
    [[50, 44], 15890700.0],
    [[50, 45], 2118760.0],
    [[50, 46], 230300.0],
    [[50, 47], 19600.0],
    [[50, 48], 1225.0],
    [[50, 49], 50.0],
    [[50, 50], 1.0],
    ];

  var n = 0;
  var k = 0;
  var v = 1;
  var failures = 0;
  for (var x=0; x<tv.length; x++) {
    n = tv[x][0][0];
    k = tv[x][0][1];
    v = tv[x][1];
    r = RiemannJS.binomial(n,k);
    if (v != r) {
      console.error("... binomial(" + n + "," + k + ") -> " + r, "actual: " + v); 
      failures++;
    } else if (verbose) {
      console.log("... binomial(" + n + "," + k + ") -> " + r); 
    }
  }

  if (failures > 0) {
    console.error("... binomial test failures:", failures);
  }
  return failures;
};
